<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yiguo.dao.Resume_post_recordMapper">
    <resultMap id="BaseResultMap" type="com.yiguo.bean.Resume_post_record">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="resume_id" property="resumeId" jdbcType="INTEGER"/>
        <result column="job_id" property="jobId" jdbcType="INTEGER"/>
        <result column="state" property="state" jdbcType="TINYINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <!-- sql语句，调用now函数 -->
    <sql id="insert">
   insert into resume_post_record (id, resume_id, job_id, 
      state, create_time, update_time
      )
    values (#{id,jdbcType=INTEGER}, #{resumeId,jdbcType=INTEGER}, #{jobId,jdbcType=INTEGER}, 
      #{state,jdbcType=TINYINT}, now(), now()
      )

</sql>
    <select id="selectBy" resultType="java.util.HashMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        SELECT j_id job_id,title,p.id resume_post_record_id,p.create_time posttime,p.state,r.education
        FROM
        (SELECT j.id j_id,j.title title FROM
        job j WHERE 1=1
        <if test="arg0!= null">
            and j.title REGEXP #{arg0}
        </if>
        <if test="arg1!= null">
            and j.enterprise_id= #{arg1}
        </if>)j2
        JOIN
        (SELECT * FROM resume_post_record p2
        WHERE 1=1
        <if test="arg2!= null">
            and resume_id in ( select id from resume where  user_id=#{arg2})
        </if>
        <if test="arg3!= null">
            and state= #{arg3}
        </if>) p
        on j_id = p.job_id
        JOIN resume r on p.resume_id = r.id;
    </select>

    <select id="selectCounts" resultType="java.lang.Integer">
        SELECT count(*)
        FROM
        (SELECT j.id j_id,j.title title FROM
        job j WHERE 1=1
        <if test="arg0!= null">
            and j.title REGEXP #{arg0}
        </if>
        <if test="arg1!= null">
            and j.enterprise_id= #{arg1}
        </if>)j2
        JOIN
        (SELECT * FROM resume_post_record p2
        WHERE 1=1
        <if test="arg2!= null">
            and resume_id in ( select id from resume where  user_id=#{arg2})
        </if>
        <if test="arg3!= null">
            and state= #{arg3}
        </if>) p
        on j_id = p.job_id
        JOIN resume r on p.resume_id = r.id;
    </select>
    <!-- 查询数据 -->

    <select id="query" parameterType="com.yiguo.bean.Resume_post_record" resultMap="BaseResultMap">
        select *
        from resume_post_record
        WHERE 1=1
        <if test="resumeId!= null">
            and resume_id = #{resumeId,jdbcType=INTEGER}
        </if>
        <if test="jobId!= null">
            and job_id = #{jobId,jdbcType=INTEGER}
        </if>
        <if test="state!= null">
            and state= #{state,jdbcType=TINYINT}
        </if>

    </select>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, resume_id, job_id, state, create_time, update_time
    </sql>
    <!-- 主键查询数据 -->
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select *
        from resume_post_record
        where id = #{id,jdbcType=INTEGER}
    </select>
    <!-- 删除数据 -->
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from resume_post_record
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <!--插入数据，调用sql函数  -->
    <insert id="insert" parameterType="com.yiguo.bean.Resume_post_record">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <include refid="insert"/>
    </insert>
    <insert id="insertSelective" parameterType="com.yiguo.bean.Resume_post_record">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into resume_post_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="resumeId != null">
                resume_id,
            </if>
            <if test="jobId != null">
                job_id,
            </if>
            <if test="state != null">
                state,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="resumeId != null">
                #{resumeId,jdbcType=INTEGER},
            </if>
            <if test="jobId != null">
                #{jobId,jdbcType=INTEGER},
            </if>
            <if test="state != null">
                #{state,jdbcType=TINYINT},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <!-- 根据主键进行更新，部分更新 -->
    <update id="updateByPrimaryKeySelective" parameterType="com.yiguo.bean.Resume_post_record">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update resume_post_record
        <set>
            <if test="resumeId != null">
                resume_id = #{resumeId,jdbcType=INTEGER},
            </if>
            <if test="jobId != null">
                job_id = #{jobId,jdbcType=INTEGER},
            </if>
            <if test="state != null">
                state = #{state,jdbcType=TINYINT},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <!-- 根据主键进行更新，全部更新 -->
    <update id="updateByPrimaryKey" parameterType="com.yiguo.bean.Resume_post_record">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update resume_post_record
        set resume_id = #{resumeId,jdbcType=INTEGER},
        job_id = #{jobId,jdbcType=INTEGER},
        state = #{state,jdbcType=TINYINT},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_time = #{updateTime,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <!-- 查詢数量 -->
    <select id="selectCount" parameterType="com.yiguo.bean.Resume_post_record" resultType="Integer">
        SELECT count(*)
        FROM resume_post_record
        WHERE 1=1
        <if test="resumeId != null">
            resume_id = #{resumeId,jdbcType=INTEGER},
        </if>
        <if test="jobId != null">
            job_id = #{jobId,jdbcType=INTEGER},
        </if>
        <if test="state != null">
            state = #{state,jdbcType=TINYINT},
        </if>
        <if test="createTime != null">
            create_time = #{createTime,jdbcType=TIMESTAMP},
        </if>
        <if test="updateTime != null">
            update_time = #{updateTime,jdbcType=TIMESTAMP},
        </if>
    </select>
    <!-- 查詢job数量 -->
    <select id="selectjob" parameterType="com.yiguo.bean.Resume_post_record" resultType="Integer">
    SELECT count(*)
    FROM resume_post_record
     WHERE job_id IN
       (SELECT id jid FROM job WHERE enterprise_id = #{enterpriseId,jdbcType=INTEGER})
    
  </select>

    <!-- 查詢job数量 且状态为1 -->
    <select id="selectjob1" parameterType="com.yiguo.bean.Resume_post_record" resultType="Integer">
   SELECT count(*)
    FROM resume_post_record
     WHERE job_id IN
       (SELECT id jid FROM job WHERE enterprise_id = #{enterpriseId,jdbcType=INTEGER})
     and
        state = 1
    
  </select>
    <!-- 分页查詢 -->
    <select id="select" parameterType="Map" resultMap="BaseResultMap">
        SELECT *
        FROM resume_post_record
        WHERE 1=1
        <if test="resumeId != null">
            and resume_id = #{resumeId,jdbcType=INTEGER}
        </if>
        <if test="jobId != null">
            and job_id = #{jobId,jdbcType=INTEGER}
        </if>
        <if test="state != null">
            and state = #{state,jdbcType=TINYINT}
        </if>
        <if test="createTime != null">
            and create_time = #{createTime,jdbcType=TIMESTAMP}
        </if>
        <if test="updateTime != null">
            and update_time = #{updateTime,jdbcType=TIMESTAMP}
        </if>
        <if test="start != null and pageSize!=null">
            limit #{start},#{pageSize}
        </if>
    </select>


    <select id="findByResumeId" parameterType="com.yiguo.bean.Resume_post_record" resultType="Integer">
        SELECT count(*)
        FROM resume_post_record
        WHERE
        resume_id  = #{resumeId,jdbcType=INTEGER}
    </select>
</mapper>